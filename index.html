<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pomodoro Timer Pro</title>
<style>
  :root {
    --accent-color: #2196f3;
    --background: #f5f7fa;
    --text-color: #222;
    --dark-background: #121212;
    --dark-text-color: #eee;
    --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  body {
    margin: 0;
    font-family: var(--font-family);
    background-color: var(--background);
    color: var(--text-color);
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
    transition: background-color 0.3s, color 0.3s;
  }

  body.dark {
    background-color: var(--dark-background);
    color: var(--dark-text-color);
  }

  h1 {
    margin-bottom: 10px;
    font-weight: 700;
  }

  .timer-display {
    font-size: 5rem;
    font-weight: 700;
    margin: 20px 0;
  }

  .session-type {
    font-size: 1.5rem;
    margin-bottom: 20px;
  }

  .controls, .settings, .stats {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
  }

  button {
    background-color: var(--accent-color);
    border: none;
    color: white;
    padding: 12px 20px;
    font-size: 1rem;
    cursor: pointer;
    border-radius: 6px;
    transition: background-color 0.2s;
    min-width: 90px;
  }
  button:disabled {
    background-color: #bbb;
    cursor: default;
  }
  button:hover:not(:disabled) {
    background-color: #0b7dda;
  }

  label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 1rem;
    cursor: pointer;
  }

  input[type="number"] {
    width: 60px;
    padding: 6px 8px;
    border-radius: 5px;
    border: 1.5px solid #ccc;
    font-size: 1rem;
    text-align: center;
    transition: border-color 0.3s;
  }
  input[type="number"]:focus {
    border-color: var(--accent-color);
    outline: none;
  }

  select {
    padding: 6px 10px;
    font-size: 1rem;
    border-radius: 6px;
    border: 1.5px solid #ccc;
    cursor: pointer;
  }

  .settings-section {
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 15px 20px;
    max-width: 400px;
    width: 100%;
    background-color: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  body.dark .settings-section {
    background-color: #1e1e1e;
    border-color: #333;
    box-shadow: 0 2px 8px rgba(255,255,255,0.05);
  }

  .settings-section h2 {
    margin-top: 0;
    margin-bottom: 15px;
    font-weight: 600;
    text-align: center;
  }

  .stats {
    justify-content: space-around;
    width: 100%;
    max-width: 400px;
  }
  .stats div {
    font-size: 1.2rem;
    font-weight: 600;
  }

  footer {
    margin-top: auto;
    font-size: 0.9rem;
    color: #666;
  }

  /* Responsive */
  @media (max-width: 480px) {
    .timer-display {
      font-size: 3.5rem;
    }
    .controls button {
      min-width: 70px;
      padding: 10px 14px;
      font-size: 0.9rem;
    }
    .settings-section {
      max-width: 100%;
      padding: 10px 15px;
    }
  }
</style>
</head>
<body>
  <h1>Pomodoro Timer Pro</h1>
  <div class="session-type" id="session-type">Work Session</div>
  <div class="timer-display" id="timer-display">25:00</div>

  <div class="controls">
    <button id="start-btn">Start</button>
    <button id="pause-btn" disabled>Pause</button>
    <button id="reset-btn">Reset</button>
  </div>

  <div class="settings-section">
    <h2>Settings</h2>

    <div style="margin-bottom:12px;">
      <label for="work-duration">Work (min): 
        <input type="number" id="work-duration" min="1" max="180" value="25" />
      </label>
    </div>
    <div style="margin-bottom:12px;">
      <label for="short-break-duration">Short Break (min): 
        <input type="number" id="short-break-duration" min="1" max="60" value="5" />
      </label>
    </div>
    <div style="margin-bottom:12px;">
      <label for="long-break-duration">Long Break (min): 
        <input type="number" id="long-break-duration" min="1" max="60" value="15" />
      </label>
    </div>

    <div style="margin-bottom:12px;">
      <label>
        <input type="checkbox" id="auto-start" /> Auto-start next session
      </label>
    </div>

    <div style="margin-bottom:12px;">
      <label>
        <input type="checkbox" id="sound-toggle" checked /> Enable Sound
      </label>
      <select id="sound-select" aria-label="Select alert sound" title="Select alert sound">
        <option value="beep">Beep</option>
        <option value="chime">Chime</option>
        <option value="ring">Ring</option>
      </select>
    </div>

    <div style="margin-bottom:12px;">
      <label>
        <input type="checkbox" id="vibration-toggle" checked /> Enable Vibration
      </label>
    </div>

    <div style="margin-bottom:12px;">
      <label>
        <input type="checkbox" id="darkmode-toggle" /> Dark Mode
      </label>
    </div>

    <button id="request-notif-btn">Request Notification Permission</button>
  </div>

  <div class="stats">
    <div>Pomodoros today: <span id="pomodoros-count">0</span></div>
    <div>Current streak: <span id="streak-count">0</span></div>
  </div>

  <footer>Made with ❤️ by ChatGPT</footer>

<script>
(() => {
  // Constants
  const SESSION_WORK = "work";
  const SESSION_SHORT_BREAK = "short_break";
  const SESSION_LONG_BREAK = "long_break";

  // Elements
  const timerDisplay = document.getElementById("timer-display");
  const sessionTypeEl = document.getElementById("session-type");
  const startBtn = document.getElementById("start-btn");
  const pauseBtn = document.getElementById("pause-btn");
  const resetBtn = document.getElementById("reset-btn");
  const workInput = document.getElementById("work-duration");
  const shortBreakInput = document.getElementById("short-break-duration");
  const longBreakInput = document.getElementById("long-break-duration");
  const autoStartToggle = document.getElementById("auto-start");
  const soundToggle = document.getElementById("sound-toggle");
  const vibrationToggle = document.getElementById("vibration-toggle");
  const soundSelect = document.getElementById("sound-select");
  const darkModeToggle = document.getElementById("darkmode-toggle");
  const requestNotifBtn = document.getElementById("request-notif-btn");
  const pomodorosCountEl = document.getElementById("pomodoros-count");
  const streakCountEl = document.getElementById("streak-count");

  // Sounds
  const sounds = {
    beep: new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg"),
    chime: new Audio("https://actions.google.com/sounds/v1/alarms/chime.ogg"),
    ring: new Audio("https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg"),
  };

  // Timer variables
  let currentSession = SESSION_WORK;
  let remainingSeconds = 0;
  let timerInterval = null;
  let isRunning = false;
  let sessionCount = 0; // to track sessions for long break

  // Stats
  let pomodorosCompletedToday = 0;
  let currentStreak = 0;

  // Utility: Format seconds to MM:SS
  function secondsToMMSS(sec) {
    const m = Math.floor(sec / 60);
    const s = sec % 60;
    return `${m.toString().padStart(2, "0")}:${s.toString().padStart(2, "0")}`;
  }

  // Load settings from localStorage
  function loadSettings() {
    const settings = JSON.parse(localStorage.getItem("pomodoro-settings"));
    if (!settings) return;
    if (typeof settings.workDuration === "number") workInput.value = settings.workDuration;
    if (typeof settings.shortBreakDuration === "number") shortBreakInput.value = settings.shortBreakDuration;
    if (typeof settings.longBreakDuration === "number") longBreakInput.value = settings.longBreakDuration;
    if (typeof settings.autoStart === "boolean") autoStartToggle.checked = settings.autoStart;
    if (typeof settings.soundOn === "boolean") soundToggle.checked = settings.soundOn;
    if (typeof settings.vibrationOn === "boolean") vibrationToggle.checked = settings.vibrationOn;
    if (settings.soundName && sounds[settings.soundName]) soundSelect.value = settings.soundName;
    if (typeof settings.darkMode === "boolean") {
      darkModeToggle.checked = settings.darkMode;
      applyDarkMode(settings.darkMode);
    }
  }

  // Save settings to localStorage
  function saveSettings() {
    const settings = {
      workDuration: parseInt(workInput.value),
      shortBreakDuration: parseInt(shortBreakInput.value),
      longBreakDuration: parseInt(longBreakInput.value),
      autoStart: autoStartToggle.checked,
      soundOn: soundToggle.checked,
      vibrationOn: vibrationToggle.checked,
      soundName: soundSelect.value,
      darkMode: darkModeToggle.checked,
    };
    localStorage.setItem("pomodoro-settings", JSON.stringify(settings));
  }

  // Load stats from localStorage
  function loadStats() {
    const data = JSON.parse(localStorage.getItem("pomodoro-stats"));
    if (!data) return;
    const today = new Date().toISOString().slice(0, 10);
    if (data.date === today) {
      pomodorosCompletedToday = data.pomodoros || 0;
      currentStreak = data.streak || 0;
      sessionCount = data.sessionCount || 0;
    } else {
      pomodorosCompletedToday = 0;
      currentStreak = 0;
      sessionCount = 0;
    }
    updateStatsDisplay();
  }

  // Save stats to localStorage
  function saveStats() {
    const today = new Date().toISOString().slice(0, 10);
    localStorage.setItem("pomodoro-stats", JSON.stringify({
      date: today,
      pomodoros: pomodorosCompletedToday,
      streak: currentStreak,
      sessionCount: sessionCount,
    }));
  }

  // Update stats display
  function updateStatsDisplay() {
    pomodorosCountEl.textContent = pomodorosCompletedToday;
    streakCountEl.textContent = currentStreak;
  }

  // Apply dark mode toggle
  function applyDarkMode(enabled) {
    if (enabled) {
      document.body.classList.add("dark");
    } else {
      document.body.classList.remove("dark");
    }
  }

  // Set the current session and update UI
  function setSession(session) {
    currentSession = session;
    if (session === SESSION_WORK) {
      remainingSeconds = parseInt(workInput.value) * 60;
      sessionTypeEl.textContent = "Work Session";
    } else if (session === SESSION_SHORT_BREAK) {
      remainingSeconds = parseInt(shortBreakInput.value) * 60;
      sessionTypeEl.textContent = "Short Break";
    } else if (session === SESSION_LONG_BREAK) {
      remainingSeconds = parseInt(longBreakInput.value) * 60;
      sessionTypeEl.textContent = "Long Break";
    }
    updateTimerDisplay();
  }

  // Update timer display
  function updateTimerDisplay() {
    timerDisplay.textContent = secondsToMMSS(remainingSeconds);
  }

  // Timer functions
  function startTimer() {
    if (isRunning) return;
    if (remainingSeconds <= 0) setSession(currentSession);
    isRunning = true;
    startBtn.disabled = true;
    pauseBtn.disabled = false;

    timerInterval = setInterval(() => {
      remainingSeconds--;
      if (remainingSeconds < 0) remainingSeconds = 0;
      updateTimerDisplay();

      if (remainingSeconds === 0) {
        clearInterval(timerInterval);
        isRunning = false;
        startBtn.disabled = false;
        pauseBtn.disabled = true;
        handleSessionEnd();
      }
    }, 1000);
  }

  function pauseTimer() {
    if (!isRunning) return;
    clearInterval(timerInterval);
    isRunning = false;
    startBtn.disabled = false;
    pauseBtn.disabled = true;
  }

  function resetTimer() {
    clearInterval(timerInterval);
    isRunning = false;
    startBtn.disabled = false;
    pauseBtn.disabled = true;
    setSession(currentSession);
  }

  // Session end handling
  function handleSessionEnd() {
    playAlert();
    vibrateAlert();
    showNotification();

    if (currentSession === SESSION_WORK) {
      pomodorosCompletedToday++;
      currentStreak++;
      sessionCount++;

      // Every 4 work sessions, long break
      if (sessionCount % 4 === 0) {
        setSession(SESSION_LONG_BREAK);
      } else {
        setSession(SESSION_SHORT_BREAK);
      }
    } else {
      setSession(SESSION_WORK);
    }

    updateStatsDisplay();
    saveStats();

    if (autoStartToggle.checked) {
      startTimer();
    }
  }

  // Play alert sound
  function playAlert() {
    if (!soundToggle.checked) return;
    const sound = sounds[soundSelect.value];
    if (sound) {
      sound.pause();
      sound.currentTime = 0;
      sound.play().catch(() => {
        // Handle play error silently
      });
    }
  }

  // Vibrate alert
  function vibrateAlert() {
    if (!vibrationToggle.checked) return;
    if (navigator.vibrate) {
      navigator.vibrate([200, 100, 200]);
    }
  }

  // Show notification
  function showNotification() {
    if (!("Notification" in window)) return;
    if (Notification.permission === "granted") {
      let title = "Pomodoro Timer";
      let body = "";
      if (currentSession === SESSION_WORK) body = "Work session started! Focus time.";
      else if (currentSession === SESSION_SHORT_BREAK) body = "Short break started. Relax!";
      else if (currentSession === SESSION_LONG_BREAK) body = "Long break started. Take it easy!";

      new Notification(title, {
        body: body,
        icon: "https://cdn-icons-png.flaticon.com/512/1532/1532433.png"
      });
    }
  }

  // Request notification permission
  function requestNotificationPermission() {
    if (!("Notification" in window)) {
      alert("Notifications are not supported in your browser.");
      return;
    }
    if (Notification.permission === "default") {
      Notification.requestPermission().then(permission => {
        alert(`Notification permission: ${permission}`);
      });
    } else {
      alert(`Notification permission already ${Notification.permission}`);
    }
  }

  // Event listeners
  startBtn.addEventListener("click", startTimer);
  pauseBtn.addEventListener("click", pauseTimer);
  resetBtn.addEventListener("click", resetTimer);

  [workInput, shortBreakInput, longBreakInput].forEach(input => {
    input.addEventListener("change", () => {
      // Clamp values to min/max
      if (input.value < parseInt(input.min)) input.value = input.min;
      if (input.value > parseInt(input.max)) input.value = input.max;

      saveSettings();
      // Reset current session times if relevant
      if (!isRunning) {
        if (currentSession === SESSION_WORK && input === workInput) {
          setSession(SESSION_WORK);
        } else if (currentSession === SESSION_SHORT_BREAK && input === shortBreakInput) {
          setSession(SESSION_SHORT_BREAK);
        } else if (currentSession === SESSION_LONG_BREAK && input === longBreakInput) {
          setSession(SESSION_LONG_BREAK);
        }
      }
    });
  });

  autoStartToggle.addEventListener("change", () => saveSettings());
  soundToggle.addEventListener("change", () => saveSettings());
  vibrationToggle.addEventListener("change", () => saveSettings());
  soundSelect.addEventListener("change", () => saveSettings());

  darkModeToggle.addEventListener("change", () => {
    applyDarkMode(darkModeToggle.checked);
    saveSettings();
  });

  requestNotifBtn.addEventListener("click", requestNotificationPermission);

  // Initialize
  function init() {
    loadSettings();
    loadStats();
    setSession(SESSION_WORK);
    updateStatsDisplay();
  }

  init();
})();
</script>
</body>
</html>
